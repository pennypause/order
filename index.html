<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√§ckerei Bestellsystem</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            /* Hintergrundbild hinzugef√ºgt */
            background-image: url('https://images.unsplash.com/photo-1589339482103-65158320b37f?auto=format&fit=crop&w=1920&q=80');
            background-attachment: fixed;
            background-size: cover;
            background-position: center;
        }
        /* Overlay f√ºr bessere Lesbarkeit */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 250, 245, 0.92); /* Heller, warmer Overlay */
            z-index: -1;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ‚ö†Ô∏è WICHTIG: Hier deine Firebase Config einf√ºgen!
        const firebaseConfig = {
            apiKey: "AIzaSyBWB_a6Dm1cpxtUf6H3WvS1BjMK8ZobXs8",
            authDomain: "penny-375d8.firebaseapp.com",
            projectId: "penny-375d8",
            storageBucket: "penny-375d8.firebasestorage.app",
            messagingSenderId: "375895348584",
            appId: "1:375895348584:web:8cd2e703497eb15f29b2dd"
        };

        // Firebase initialisieren
        let db = null;
        let auth = null;
        
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
            auth = firebase.auth();
        } catch (error) {
            console.error("Firebase Initialisierungsfehler:", error);
        }

        // Icons
        const ShoppingCart = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>
            </svg>
        );

        const Edit2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
            </svg>
        );

        const Plus = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const LogOut = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
        );

        const LogIn = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                <polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/>
            </svg>
        );

        const Check = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="20 6 9 17 4 12"/>
            </svg>
        );
        
        const Search = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
        );

        // --- Auth Component ---
        const AuthScreen = ({ onLogin }) => {
            const [isRegistering, setIsRegistering] = useState(false);
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [termsAccepted, setTermsAccepted] = useState(false);
            const [error, setError] = useState("");
            const [isLoading, setIsLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError("");
                setIsLoading(true);

                try {
                    if (isRegistering) {
                        if (!termsAccepted) {
                            throw new Error("Bitte akzeptiere die Zahlungsbedingungen.");
                        }
                        await auth.createUserWithEmailAndPassword(email, password);
                    } else {
                        await auth.signInWithEmailAndPassword(email, password);
                    }
                } catch (err) {
                    console.error(err);
                    if (err.code === 'auth/operation-not-allowed') {
                        setError("Email/Passwort Login ist in Firebase nicht aktiviert.");
                    } else if (err.code === 'auth/email-already-in-use') {
                        setError("Diese Email wird bereits verwendet.");
                    } else if (err.code === 'auth/weak-password') {
                        setError("Das Passwort muss mindestens 6 Zeichen haben.");
                    } else if (err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found') {
                        setError("Falsche Email oder Passwort.");
                    } else {
                        setError(err.message);
                    }
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md">
                        <div className="text-center mb-8">
                            <h1 className="text-3xl font-bold text-orange-600 mb-2">B√§ckerei Login</h1>
                            <p className="text-gray-600">
                                {isRegistering ? "Erstelle einen Account um zu bestellen" : "Willkommen zur√ºck!"}
                            </p>
                        </div>

                        {error && (
                            <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded">
                                {error}
                            </div>
                        )}

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Email Adresse</label>
                                <input
                                    type="email"
                                    required
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:outline-none"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    placeholder="deine@email.com"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Passwort</label>
                                <input
                                    type="password"
                                    required
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:outline-none"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                />
                            </div>

                            {isRegistering && (
                                <div className="flex items-start gap-3 p-4 bg-orange-50 rounded-lg border border-orange-100">
                                    <input
                                        type="checkbox"
                                        id="terms"
                                        className="mt-1 w-5 h-5 text-orange-600 rounded border-gray-300 focus:ring-orange-500 cursor-pointer"
                                        checked={termsAccepted}
                                        onChange={(e) => setTermsAccepted(e.target.checked)}
                                    />
                                    <label htmlFor="terms" className="text-sm text-gray-700 cursor-pointer select-none">
                                        Ich akzeptiere die <span className="font-bold">Nutzungsbedingungen</span> und best√§tige hiermit, dass ich <span className="font-bold text-red-600">alles bezahlen muss</span>, was ich bestelle.
                                    </label>
                                </div>
                            )}

                            <button
                                type="submit"
                                disabled={isLoading || (isRegistering && !termsAccepted)}
                                className={`w-full py-3 rounded-lg font-bold text-white shadow-lg transition-all 
                                    ${(isLoading || (isRegistering && !termsAccepted)) 
                                        ? 'bg-gray-400 cursor-not-allowed' 
                                        : 'bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 transform hover:-translate-y-0.5'}`}
                            >
                                {isLoading ? "L√§dt..." : (isRegistering ? "Account erstellen" : "Einloggen")}
                            </button>
                        </form>

                        <div className="mt-6 text-center">
                            <button
                                onClick={() => {
                                    setIsRegistering(!isRegistering);
                                    setError("");
                                    setTermsAccepted(false);
                                }}
                                className="text-orange-600 hover:text-orange-800 font-medium"
                            >
                                {isRegistering ? "Bereits einen Account? Hier einloggen" : "Noch keinen Account? Registrieren"}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Firebase Hook
        const useFirebase = (currentUser) => {
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [deliveryRate] = useState(0.30); // Ge√§ndert auf 0.30
            const [loading, setLoading] = useState(true);

            // Load products from Firestore
            useEffect(() => {
                if (!db || !currentUser) {
                    setLoading(false);
                    return;
                }

                const unsubscribe = db.collection('products')
                    .onSnapshot(
                        (snapshot) => {
                            const productsData = snapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data()
                            }));
                            
                            if (productsData.length === 0) {
                                // Initial products if none exist
                                const initialProducts = [
                                    { name: 'Croissant', price: 2.50, imageUrl: 'https://images.unsplash.com/photo-1555507036-ab1f4038808a?w=400', description: 'Buttrig und knusprig', totalSold: 0 },
                                    { name: 'Brezel', price: 1.80, imageUrl: 'https://images.unsplash.com/photo-1558961363-fa8fdf82db35?w=400', description: 'Frisch gebacken', totalSold: 0 },
                                    { name: 'Baguette', price: 3.20, imageUrl: 'https://images.unsplash.com/photo-1549931319-a545dcf3bc73?w=400', description: 'Franz√∂sisches Baguette', totalSold: 0 },
                                    { name: 'Br√∂tchen', price: 0.60, imageUrl: 'https://images.unsplash.com/photo-1509440159596-0249088772ff?w=400', description: 'Klassisches Br√∂tchen', totalSold: 0 },
                                ];
                                
                                initialProducts.forEach(product => {
                                    db.collection('products').add(product).catch(err => {
                                        console.error("Fehler beim Hinzuf√ºgen von Produkt:", err);
                                    });
                                });
                                setProducts([]);
                            } else {
                                setProducts(productsData);
                            }
                            setLoading(false);
                        },
                        (error) => {
                            console.error("Fehler beim Laden der Produkte:", error);
                            setLoading(false);
                        }
                    );

                return () => unsubscribe();
            }, [currentUser]);

            // Load orders from Firestore
            useEffect(() => {
                if (!db || !currentUser) return;

                const unsubscribe = db.collection('orders')
                    .orderBy('timestamp', 'desc')
                    .onSnapshot(
                        (snapshot) => {
                            const ordersData = snapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data()
                            }));
                            setOrders(ordersData);
                        },
                        (error) => {
                            console.error("Fehler beim Laden der Bestellungen:", error);
                            db.collection('orders').onSnapshot((snapshot) => {
                                const ordersData = snapshot.docs.map(doc => ({
                                    id: doc.id,
                                    ...doc.data()
                                }));
                                setOrders(ordersData);
                            });
                        }
                    );

                return () => unsubscribe();
            }, [currentUser]);

            const addOrder = async (order) => {
                const newOrder = {
                    ...order,
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'pending'
                };

                await db.collection('orders').add(newOrder);

                for (const item of order.items) {
                    const productRef = db.collection('products').doc(item.id);
                    const productDoc = await productRef.get();
                    
                    if (productDoc.exists) {
                        const currentSold = productDoc.data().totalSold || 0;
                        await productRef.update({
                            totalSold: currentSold + item.quantity
                        });
                    }
                }
            };

            const updateOrder = async (id, updates) => {
                await db.collection('orders').doc(id).update(updates);
            };

            const deleteOrder = async (id) => {
                await db.collection('orders').doc(id).delete();
            };

            const updateProduct = async (id, updates) => {
                await db.collection('products').doc(id).update(updates);
            };

            const addProduct = async (product) => {
                await db.collection('products').add({
                    ...product,
                    totalSold: 0
                });
            };

            const deleteProduct = async (id) => {
                await db.collection('products').doc(id).delete();
            };

            return {
                products,
                orders,
                deliveryRate, // Ge√§ndert
                loading,
                addOrder,
                updateOrder,
                deleteOrder,
                updateProduct,
                addProduct,
                deleteProduct
            };
        };

        const BakeryOrderSystem = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setCurrentUser(user);
                    setAuthLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const {
                products,
                orders,
                deliveryRate, // Ge√§ndert
                loading,
                addOrder,
                updateOrder,
                deleteOrder,
                updateProduct,
                addProduct,
                deleteProduct
            } = useFirebase(currentUser);

            const [cart, setCart] = useState([]);
            const [customerName, setCustomerName] = useState('');
            const [nameError, setNameError] = useState('');
            const [specialRequests, setSpecialRequests] = useState('');
            const [isAdmin, setIsAdmin] = useState(false);
            const [adminPassword, setAdminPassword] = useState('');
            const [view, setView] = useState('products');
            const [editingProduct, setEditingProduct] = useState(null);
            const [imageError, setImageError] = useState({});
            const [searchTerm, setSearchTerm] = useState(''); // State f√ºr Suchleiste

            const handleLogout = () => {
                auth.signOut();
                setIsAdmin(false);
                setView('products');
                setCart([]);
                setCustomerName('');
                setNameError('');
            };

            const addToCart = (product) => {
                const existing = cart.find(item => item.id === product.id);
                if (existing) {
                    setCart(cart.map(item =>
                        item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item
                    ));
                } else {
                    setCart([...cart, { ...product, quantity: 1 }]);
                }
            };

            const updateCartQuantity = (id, quantity) => {
                if (quantity <= 0) {
                    setCart(cart.filter(item => item.id !== id));
                } else {
                    setCart(cart.map(item =>
                        item.id === id ? { ...item, quantity } : item
                    ));
                }
            };

            // --- ANGEPASSTE BERECHNUNGEN ---
            const calculateDeliveryCost = () => {
                const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
                return totalQuantity * deliveryRate;
            };

            const calculateTotal = () => {
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                return subtotal + calculateDeliveryCost();
            };
            // --- ENDE BERECHNUNGEN ---

            const submitOrder = async () => {
                if (cart.length === 0) {
                    alert('Der Warenkorb ist leer!');
                    return;
                }

                if (!customerName.trim()) {
                    setNameError('Bitte gib deinen Namen ein, um die Bestellung abzuschlie√üen.');
                    return;
                }

                const calculatedDelivery = calculateDeliveryCost(); // Berechnete Kosten

                await addOrder({
                    customerName,
                    items: cart,
                    specialRequests,
                    total: calculateTotal(),
                    deliveryCost: calculatedDelivery // Gespeicherte Kosten
                });

                alert('Bestellung erfolgreich aufgegeben!');
                setCart([]);
                setCustomerName('');
                setNameError('');
                setSpecialRequests('');
                setView('products');
            };

            const adminLogin = () => {
                if (adminPassword === 'admin123') {
                    setIsAdmin(true);
                    setView('admin');
                    setAdminPassword('');
                } else {
                    alert('Falsches Passwort!');
                }
            };

            const formatTime = (timestamp) => {
                if (!timestamp) return 'L√§dt...';
                const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
                return date.toLocaleString('de-DE');
            };

            const handleImageError = (productId) => {
                setImageError(prev => ({ ...prev, [productId]: true }));
            };
            
            // Gefilterte Produkte f√ºr die Suche
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                product.description.toLowerCase().includes(searchTerm.toLowerCase())
            );

            if (authLoading || (currentUser && loading)) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-2xl text-orange-600 font-bold animate-pulse">Lade B√§ckerei...</div>
                    </div>
                );
            }

            if (!currentUser) {
                return <AuthScreen />;
            }

            // Customer View - Products
            if (view === 'products' && !isAdmin) {
                return (
                    <div className="min-h-screen p-4">
                        <div className="max-w-6xl mx-auto">
                            <header className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                                    <div>
                                        <h1 className="text-3xl font-bold text-orange-600">B√§ckerei Bestellsystem</h1>
                                        <p className="text-gray-600 mt-1">Angemeldet als: {currentUser.email}</p>
                                    </div>
                                    <div className="flex gap-3 flex-wrap justify-center">
                                        <button
                                            onClick={() => setView('cart')}
                                            className="bg-orange-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-orange-600"
                                        >
                                            <ShoppingCart size={20} />
                                            <span>Warenkorb ({cart.length})</span>
                                        </button>
                                        <button
                                            onClick={() => setView('adminLogin')}
                                            className="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-gray-200"
                                            title="Mitarbeiter Login"
                                        >
                                            <LogIn size={20} />
                                        </button>
                                        <button
                                            onClick={handleLogout}
                                            className="bg-red-100 text-red-600 px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-red-200"
                                            title="Abmelden"
                                        >
                                            <LogOut size={20} />
                                        </button>
                                    </div>
                                </div>
                                {/* Suchleiste */}
                                <div className="mt-6 relative">
                                    <input
                                        type="text"
                                        placeholder="Produkte suchen (z.B. Brezel, knusprig...)"
                                        className="w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:outline-none"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                    <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                                        <Search size={20} />
                                    </div>
                                </div>
                            </header>

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {filteredProducts.map(product => (
                                    <div
                                        key={product.id}
                                        className="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow group"
                                    >
                                        <div className="aspect-square bg-white flex items-center justify-center overflow-hidden relative">
                                            {imageError[product.id] ? (
                                                <div className="text-6xl">üçû</div>
                                            ) : (
                                                <img 
                                                    src={product.imageUrl} 
                                                    alt={product.name}
                                                    className="w-full h-full object-cover"
                                                    onError={() => handleImageError(product.id)}
                                                />
                                            )}
                                        </div>
                                        <div className="p-4">
                                            <h3 className="font-bold text-xl text-gray-800">{product.name}</h3>
                                            <p className="text-gray-600 text-sm mt-1 h-10">{product.description}</p>
                                            <div className="mt-3 flex justify-between items-center">
                                                <span className="text-2xl font-bold text-orange-600">{product.price.toFixed(2)} ‚Ç¨</span>
                                                <button 
                                                    onClick={() => addToCart(product)}
                                                    className="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 active:bg-orange-700 transition-colors"
                                                >
                                                    Hinzuf√ºgen
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                {filteredProducts.length === 0 && (
                                    <p className="text-gray-600 md:col-span-2 lg:col-span-3 text-center py-8">
                                        Keine Produkte f√ºr "{searchTerm}" gefunden.
                                    </p>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // Cart View
            if (view === 'cart') {
                return (
                    <div className="min-h-screen p-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">Warenkorb</h2>
                                    <button
                                        onClick={() => setView('products')}
                                        className="text-orange-600 hover:text-orange-700 font-medium"
                                    >
                                        ‚Üê Zur√ºck zur Auswahl
                                    </button>
                                </div>

                                {cart.length === 0 ? (
                                    <p className="text-gray-600 text-center py-8">Dein Warenkorb ist noch leer.</p>
                                ) : (
                                    <>
                                        <div className="space-y-4 mb-6">
                                            {cart.map(item => (
                                                <div key={item.id} className="flex items-center gap-4 border-b pb-4">
                                                    <div className="w-16 h-16 bg-white rounded-lg overflow-hidden flex-shrink-0">
                                                        {imageError[item.id] ? (
                                                            <div className="w-full h-full flex items-center justify-center text-2xl">üçû</div>
                                                        ) : (
                                                            <img 
                                                                src={item.imageUrl} 
                                                                alt={item.name}
                                                                className="w-full h-full object-cover"
                                                                onError={() => handleImageError(item.id)}
                                                            />
                                                        )}
                                                    </div>
                                                    <div className="flex-1">
                                                        <h3 className="font-bold">{item.name}</h3>
                                                        <p className="text-gray-600">{item.price.toFixed(2)} ‚Ç¨ / St√ºck</p>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <button
                                                            onClick={() => updateCartQuantity(item.id, item.quantity - 1)}
                                                            className="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300"
                                                        >
                                                            -
                                                        </button>
                                                        <span className="font-bold px-3 w-8 text-center">{item.quantity}</span>
                                                        <button
                                                            onClick={() => updateCartQuantity(item.id, item.quantity + 1)}
                                                            className="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300"
                                                        >
                                                            +
                                                        </button>
                                                    </div>
                                                    <div className="font-bold text-orange-600 w-24 text-right">
                                                        {(item.price * item.quantity).toFixed(2)} ‚Ç¨
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        <div className="space-y-4 mb-6 bg-gray-50 p-4 rounded-lg">
                                            <h3 className="font-bold text-gray-700">Bestellungsdetails</h3>
                                            <div>
                                                <input
                                                    type="text"
                                                    placeholder="Dein Name f√ºr die Bestellung"
                                                    value={customerName}
                                                    onChange={(e) => {
                                                        setCustomerName(e.target.value);
                                                        if (e.target.value.trim()) setNameError('');
                                                    }}
                                                    className={`w-full border rounded-lg px-4 py-2 outline-none transition-colors ${
                                                        nameError 
                                                            ? 'border-red-500 focus:ring-2 focus:ring-red-200' 
                                                            : 'border-gray-300 focus:ring-2 focus:ring-orange-200'
                                                    }`}
                                                />
                                                {nameError && (
                                                    <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                                                        <span className="font-bold">!</span> {nameError}
                                                    </p>
                                                )}
                                            </div>
                                            <textarea
                                                placeholder="Extraw√ºnsche (optional)"
                                                value={specialRequests}
                                                onChange={(e) => setSpecialRequests(e.target.value)}
                                                className="w-full border border-gray-300 rounded-lg px-4 py-2 h-24 focus:ring-2 focus:ring-orange-200 focus:outline-none"
                                            />
                                        </div>
                                        
                                        {/* Angepasste Kostenanzeige */}
                                        <div className="border-t pt-4 space-y-2">
                                            <div className="flex justify-between">
                                                <span>Zwischensumme:</span>
                                                <span>{(calculateTotal() - calculateDeliveryCost()).toFixed(2)} ‚Ç¨</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Lieferkosten ({deliveryRate.toFixed(2)} ‚Ç¨ pro Produkt):</span>
                                                <span className="text-gray-600">{calculateDeliveryCost().toFixed(2)} ‚Ç¨</span>
                                            </div>
                                            <div className="flex justify-between text-xl font-bold text-orange-600 border-t pt-2">
                                                <span>Gesamt:</span>
                                                <span>{calculateTotal().toFixed(2)} ‚Ç¨</span>
                                            </div>
                                        </div>

                                        <div className="mt-4 text-sm text-gray-500 text-center">
                                            * Mit Klick auf "Bestellung aufgeben" best√§tigst du erneut die Zahlungsverpflichtung.
                                        </div>

                                        <button
                                            onClick={submitOrder}
                                            className="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-3 rounded-lg mt-4 hover:from-orange-600 hover:to-red-600 font-bold shadow-md transform hover:-translate-y-0.5 transition-all"
                                        >
                                            Kostenpflichtig bestellen
                                        </button>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // Admin Login
            if (view === 'adminLogin') {
                return (
                    <div className="min-h-screen p-4 flex items-center justify-center">
                        <div className="bg-white rounded-lg shadow-lg p-8 w-full max-w-md">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">Mitarbeiter Login</h2>
                                <button 
                                    onClick={() => setView('products')}
                                    className="text-gray-400 hover:text-gray-600"
                                >
                                    ‚úï
                                </button>
                            </div>
                            <input
                                type="password"
                                placeholder="Passwort"
                                value={adminPassword}
                                onChange={(e) => setAdminPassword(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && adminLogin()}
                                className="w-full border border-gray-300 rounded-lg px-4 py-2 mb-4"
                            />
                            <button
                                onClick={adminLogin}
                                className="w-full bg-orange-500 text-white py-2 rounded-lg hover:bg-orange-600 mb-2"
                            >
                                Anmelden
                            </button>
                            <p className="text-sm text-gray-500 mt-4 text-center">Demo Passwort: admin123</p>
                        </div>
                    </div>
                );
            }

            // Admin View - Orders
            if (view === 'admin' && isAdmin) {
                return (
                    <div className="min-h-screen p-4">
                        <div className="max-w-6xl mx-auto">
                            <header className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <div className="flex justify-between items-center">
                                    <h1 className="text-3xl font-bold text-orange-600">Admin Bereich</h1>
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => setView('adminProducts')}
                                            className="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"
                                        >
                                            Produkte verwalten
                                        </button>
                                        <button
                                            onClick={() => {
                                                setIsAdmin(false);
                                                setView('products');
                                            }}
                                            className="bg-gray-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-gray-600"
                                        >
                                            <LogOut size={20} />
                                            Zur√ºck zum Shop
                                        </button>
                                    </div>
                                </div>
                            </header>

                            <div className="space-y-4">
                                {orders.length === 0 ? (
                                    <div className="bg-white rounded-lg shadow-lg p-8 text-center text-gray-600">
                                        Keine Bestellungen vorhanden
                                    </div>
                                ) : (
                                    orders.map(order => (
                                        <div key={order.id} className="bg-white rounded-lg shadow-lg p-6">
                                            <div className="flex justify-between items-start mb-4">
                                                <div>
                                                    <h3 className="text-xl font-bold text-gray-800">{order.customerName}</h3>
                                                    <p className="text-gray-600 text-sm">{formatTime(order.timestamp)}</p>
                                                    <p className="text-xs text-gray-500 mt-1">Account: {order.userEmail || 'Gast'}</p>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => updateOrder(order.id, { status: 'completed' })}
                                                        className="bg-green-500 text-white p-2 rounded-lg hover:bg-green-600"
                                                        title="Bestellung abschlie√üen"
                                                    >
                                                        <Check size={20} />
                                                    </button>
                                                    <button
                                                        onClick={() => deleteOrder(order.id)}
                                                        className="bg-red-500 text-white p-2 rounded-lg hover:bg-red-600"
                                                        title="L√∂schen"
                                                    >
                                                        <Trash2 size={20} />
                                                    </button>
                                                </div>
                                            </div>

                                            <div className="space-y-2 mb-4">
                                                {order.items.map((item, idx) => (
                                                    <div key={idx} className="flex justify-between text-gray-700">
                                                        <span>{item.quantity}x {item.name}</span>
                                                        <span>{(item.price * item.quantity).toFixed(2)} ‚Ç¨</span>
                                                    </div>
                                                ))}
                                                <div className="border-t pt-2 flex justify-between">
                                                    <span className="text-sm">Lieferkosten:</span>
                                                    <span className="text-sm">{(order.deliveryCost || 0).toFixed(2)} ‚Ç¨</span>
                                                </div>
                                                <div className="flex justify-between font-bold text-orange-600">
                                                    <span>Gesamt:</span>
                                                    <span>{order.total.toFixed(2)} ‚Ç¨</span>
                                                </div>
                                            </div>

                                            {order.specialRequests && (
                                                <div className="bg-yellow-50 p-3 rounded-lg">
                                                    <p className="text-sm font-bold text-gray-700">Extraw√ºnsche:</p>
                                                    <p className="text-sm text-gray-600">{order.specialRequests}</p>
                                                </div>
                                            )}
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // Admin View - Products Management
            if (view === 'adminProducts' && isAdmin) {
                return (
                    <div className="min-h-screen p-4">
                        <div className="max-w-6xl mx-auto">
                            <header className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <div className="flex justify-between items-center">
                                    <h1 className="text-3xl font-bold text-orange-600">Produkte verwalten</h1>
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => setView('admin')}
                                            className="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600"
                                        >
                                            ‚Üê Bestellungen
                                        </button>
                                        <button
                                            onClick={() => setEditingProduct({ name: '', price: 0, imageUrl: '', description: '' })}
                                            className="bg-green-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-600"
                                        >
                                            <Plus size={20} />
                                            Neues Produkt
                                        </button>
                                    </div>
                                </div>
                            </header>

                            {/* Sales Statistics */}
                            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <h2 className="text-xl font-bold mb-4 text-gray-800">Verkaufsstatistik (Firestore)</h2>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {products.map(product => (
                                        <div key={product.id} className="bg-orange-50 p-4 rounded-lg">
                                            <p className="font-bold text-gray-800">{product.name}</p>
                                            <p className="text-2xl font-bold text-orange-600">{product.totalSold || 0}x</p>
                                            <p className="text-sm text-gray-600">verkauft</p>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {editingProduct && (
                                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                    <h2 className="text-xl font-bold mb-4">
                                        {editingProduct.id ? 'Produkt bearbeiten' : 'Neues Produkt'}
                                    </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <input
                                            type="text"
                                            placeholder="Name"
                                            value={editingProduct.name}
                                            onChange={(e) => setEditingProduct({ ...editingProduct, name: e.target.value })}
                                            className="border border-gray-300 rounded-lg px-4 py-2"
                                        />
                                        <input
                                            type="number"
                                            step="0.01"
                                            placeholder="Preis"
                                            value={editingProduct.price}
                                            onChange={(e) => setEditingProduct({ ...editingProduct, price: parseFloat(e.target.value) || 0 })}
                                            className="border border-gray-300 rounded-lg px-4 py-2"
                                        />
                                        <input
                                            type="text"
                                            placeholder="Bild URL (z.B. https://...)"
                                            value={editingProduct.imageUrl}
                                            onChange={(e) => setEditingProduct({ ...editingProduct, imageUrl: e.target.value })}
                                            className="border border-gray-300 rounded-lg px-4 py-2 md:col-span-2"
                                        />
                                        <input
                                            type="text"
                                            placeholder="Beschreibung"
                                            value={editingProduct.description}
                                            onChange={(e) => setEditingProduct({ ...editingProduct, description: e.target.value })}
                                            className="border border-gray-300 rounded-lg px-4 py-2 md:col-span-2"
                                        />
                                    </div>
                                    {editingProduct.imageUrl && (
                                        <div className="mt-4">
                                            <p className="text-sm text-gray-600 mb-2">Vorschau:</p>
                                            <img 
                                                src={editingProduct.imageUrl} 
                                                alt="Preview"
                                                className="w-32 h-32 object-cover rounded-lg"
                                                onError={(e) => {
                                                    e.target.style.display = 'none';
                                                }}
                                            />
                                        </div>
                                    )}
                                    <div className="flex gap-3 mt-4">
                                        <button
                                            onClick={() => {
                                                if (editingProduct.id) {
                                                    updateProduct(editingProduct.id, editingProduct);
                                                } else {
                                                    addProduct(editingProduct);
                                                }
                                                setEditingProduct(null);
                                            }}
                                            className="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600"
                                        >
                                            Speichern
                                        </button>
                                        <button
                                            onClick={() => setEditingProduct(null)}
                                            className="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400"
                                        >
                                            Abbrechen
                                        </button>
                                    </div>
                                </div>
                            )}

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {products.map(product => (
                                    <div key={product.id} className="bg-white rounded-lg shadow-lg overflow-hidden">
                                        <div className="aspect-square bg-white flex items-center justify-center overflow-hidden">
                                            {imageError[product.id] ? (
                                                <div className="text-6xl">üçû</div>
                                            ) : (
                                                <img 
                                                    src={product.imageUrl} 
                                                    alt={product.name}
                                                    className="w-full h-full object-cover"
                                                    onError={() => handleImageError(product.id)}
                                                />
                                            )}
                                        </div>
                                        <div className="p-4">
                                            <h3 className="font-bold text-xl text-gray-800">{product.name}</h3>
                                            <p className="text-gray-600 text-sm mt-1">{product.description}</p>
                                            <p className="text-sm text-orange-500 mt-1">Verkauft: {product.totalSold || 0}x</p>
                                            <div className="mt-3 flex justify-between items-center">
                                                <span className="text-2xl font-bold text-orange-600">{product.price.toFixed(2)} ‚Ç¨</span>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => setEditingProduct(product)}
                                                        className="bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600"
                                                    >
                                                        <Edit2 size={16} />
                                                    </button>
                                                    <button
                                                        onClick={() => deleteProduct(product.id)}
                                                        className="bg-red-500 text-white p-2 rounded-lg hover:bg-red-600"
                                                    >
                                                        <Trash2 size={16} />
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BakeryOrderSystem />);
    </script>
</body>
</html>


